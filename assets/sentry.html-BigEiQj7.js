import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as n,a}from"./app-C1V3sxns.js";const e={},l=a(`<p>Sentry是一个开源的应用性能监控（Application Performance Monitoring，APM）和错误追踪平台。 它帮助开发人员监控应用程序的性能、捕获和分析错误，以便及时发现并解决潜在的问题，提高应用程序的稳定性和用户体验</p><h2 id="部署-sentry-k8s" tabindex="-1"><a class="header-anchor" href="#部署-sentry-k8s"><span>部署 sentry （k8s）</span></a></h2><p>1.使用 helm 安装 <a href="https://github.com/sentry-kubernetes/charts" target="_blank" rel="noopener noreferrer">https://github.com/sentry-kubernetes/charts</a></p><p>Sentry 的 Helm Chart，可以方便地在 Kubernetes 集群中部署 Sentry。</p><p><code>values.yaml</code></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">filestore</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  backend</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">filesystem</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  filesystem</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/lib/sentry/files</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    persistence</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      accessMode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ReadWriteMany</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      existingClaim</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      persistentWorkers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">10Gi</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      storageClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;efs&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nginx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  ingress</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    annotations</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { }</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    hostname</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sentry.company.com</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ingressClassName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;alb&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    pathType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">postgresql</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  postgresqlPassword</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;examplePassword&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  postgresqlPostgresPassword</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;examplePassword&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sourcemaps</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  email</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">example@company.com</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">examplePassword</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">zookeeper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  autopurge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    purgeInterval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    snapRetainCount</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意问题：</p><ul><li>filestore , 需要配置 storageClass 为 ReadWriteMany 的存储类。</li><li>nginx 配置 annotation, 因为我们使用的是 AWS 的 ALB Ingress Controller。</li><li>postgresql 配置数据库密码， 防止启动时报错。<a href="https://github.com/sentry-kubernetes/charts/issues/571#issuecomment-1039616281" target="_blank" rel="noopener noreferrer">具体参见</a>, <a href="https://github.com/sentry-kubernetes/charts/issues/799" target="_blank" rel="noopener noreferrer">清理方式</a></li><li>sourcemaps 配置为 true，开启 sourcemaps 功能。</li><li>user 配置为 true，创建一个初始用户(admin)。</li><li>zookeeper 配置 autopurge, 避免 Zookeeper 数据过大。</li></ul><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> github.com/getsentry/sentry-go</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="使用代码" tabindex="-1"><a class="header-anchor" href="#使用代码"><span>使用代码：</span></a></h2><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	&quot;fmt&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	&quot;net/http&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	sentry</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;github.com/getsentry/sentry-go&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	sentrygin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;github.com/getsentry/sentry-go/gin&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	&quot;github.com/gin-gonic/gin&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// To initialize Sentry&#39;s handler, you need to initialize Sentry itself beforehand</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> sentry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Init</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">sentry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ClientOptions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	Dsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;https://0b5c4c7a72494aa8a43da8d56c1f7427@o84114.ingest.us.sentry.io/183603&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	EnableTracing</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	// Set TracesSampleRate to 1.0 to capture 100%</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	// of transactions for tracing.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	// We recommend adjusting this value in production,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	TracesSampleRate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}); </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Sentry initialization failed: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%v</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Then create your app</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">app</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Default</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Once it&#39;s done, you can attach the handler as one of your middleware</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">app</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Use</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sentrygin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">New</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">sentrygin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Options</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{}))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Set up routes</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">app</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">StatusOK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Hello world!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// And run it</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">app</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;:3000&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Configure</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sentrygin</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> accepts</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> of</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> Options</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> that</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> allows</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> you</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> to</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> configure</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> how</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> the</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> handler</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> will</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> behave</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Currently</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> it</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> respects</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> options</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Go</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Copied</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Whether Sentry should repanic after recovery, in most cases it should be set to true,</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// as gin.Default includes its own Recovery middleware that handles http responses.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Repanic</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> bool</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Whether you want to block the request before moving forward with the response.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Because Gin&#39;s default \`Recovery\` handler doesn&#39;t restart the application,</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// it&#39;s safe to either skip this option or set it to \`false\`.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">WaitForDelivery</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> bool</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Timeout for the event delivery requests.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Timeout</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Duration</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Usage</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sentrygin</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> attaches</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> an</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> instance</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> of</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sentry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Hub</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">https</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//pkg.go.dev/github.com/getsentry/sentry-go#Hub) to the *gin.Context, which makes it available throughout the rest of the request&#39;s lifetime. You can access it by using the sentrygin.GetHubFromContext() method on the context itself in any of your proceeding middleware and routes. And it should be used instead of the global sentry.CaptureMessage, sentry.CaptureException, or any other calls, as it keeps the separation of data between the requests.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Keep</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> in</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mind</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> that</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sentry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Hub</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> won</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">t be available in middleware attached before sentrygin!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">Go</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">Copied</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">app := gin.Default()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">app.Use(sentrygin.New(sentrygin.Options{</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	Repanic: true,</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">}))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">app.Use(func(ctx *gin.Context) {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	if hub := sentrygin.GetHubFromContext(ctx); hub != nil {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">		hub.Scope().SetTag(&quot;someRandomTag&quot;, &quot;maybeYouNeedIt&quot;)</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	}</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	ctx.Next()</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">app.GET(&quot;/&quot;, func(ctx *gin.Context) {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	if hub := sentrygin.GetHubFromContext(ctx); hub != nil {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">		hub.WithScope(func(scope *sentry.Scope) {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">			scope.SetExtra(&quot;unwantedQuery&quot;, &quot;someQueryDataMaybe&quot;)</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">			hub.CaptureMessage(&quot;User provided unwanted query string, but we recovered just fine&quot;)</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">		})</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	}</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	ctx.Status(http.StatusOK)</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">app.GET(&quot;/foo&quot;, func(ctx *gin.Context) {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	// sentrygin handler will catch it just fine. Also, because we attached &quot;someRandomTag&quot;</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	// in the middleware before, it will be sent through as well</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	panic(&quot;y tho&quot;)</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">app.Run(&quot;:3000&quot;)</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">Accessing Request in BeforeSend callback</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">Go</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">Copied</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">sentry.Init(sentry.ClientOptions{</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	Dsn: &quot;https://0b5c4c7a72494aa8a43da8d56c1f7427@o84114.ingest.us.sentry.io/183603&quot;,</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	BeforeSend: func(event *sentry.Event, hint *sentry.EventHint) *sentry.Event {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">		if hint.Context != nil {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">			if req, ok := hint.Context.Value(sentry.RequestContextKey).(*http.Request); ok {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">				// You have access to the original Request here</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">			}</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">		return event</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">	},</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="文档" tabindex="-1"><a class="header-anchor" href="#文档"><span>文档</span></a></h2><ul><li><a href="https://docs.sentry.io/platforms/go/" target="_blank" rel="noopener noreferrer">docs</a></li><li><a href="https://github.com/getsentry/sentry" target="_blank" rel="noopener noreferrer">sentry</a></li><li><a href="https://github.com/getsentry/sentry-go" target="_blank" rel="noopener noreferrer">sentry-go</a></li></ul>`,14),t=[l];function h(p,k){return n(),i("div",null,t)}const c=s(e,[["render",h],["__file","sentry.html.vue"]]),g=JSON.parse('{"path":"/golang/performance/sentry.html","title":"golang 性能监听工具 sentry","lang":"zh-CN","frontmatter":{"title":"golang 性能监听工具 sentry","icon":"sentry","description":"Sentry是一个开源的应用性能监控（Application Performance Monitoring，APM）和错误追踪平台。 它帮助开发人员监控应用程序的性能、捕获和分析错误，以便及时发现并解决潜在的问题，提高应用程序的稳定性和用户体验 部署 sentry （k8s） 1.使用 helm 安装 https://github.com/sentry...","head":[["meta",{"property":"og:url","content":"https://costalong.com/website/golang/performance/sentry.html"}],["meta",{"property":"og:site_name","content":"云原生笔记"}],["meta",{"property":"og:title","content":"golang 性能监听工具 sentry"}],["meta",{"property":"og:description","content":"Sentry是一个开源的应用性能监控（Application Performance Monitoring，APM）和错误追踪平台。 它帮助开发人员监控应用程序的性能、捕获和分析错误，以便及时发现并解决潜在的问题，提高应用程序的稳定性和用户体验 部署 sentry （k8s） 1.使用 helm 安装 https://github.com/sentry..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-15T15:30:04.000Z"}],["meta",{"property":"article:author","content":"Costa Long"}],["meta",{"property":"article:modified_time","content":"2024-08-15T15:30:04.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"golang 性能监听工具 sentry\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-08-15T15:30:04.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Costa Long\\",\\"url\\":\\"https://costalong.com\\"}]}"]]},"headers":[{"level":2,"title":"部署 sentry （k8s）","slug":"部署-sentry-k8s","link":"#部署-sentry-k8s","children":[]},{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":2,"title":"使用代码：","slug":"使用代码","link":"#使用代码","children":[]},{"level":2,"title":"文档","slug":"文档","link":"#文档","children":[]}],"git":{"createdTime":1723366856000,"updatedTime":1723735804000,"contributors":[{"name":"costa92","email":"944310536@qq.com","commits":4}]},"readingTime":{"minutes":2.42,"words":727},"filePathRelative":"golang/performance/sentry.md","localizedDate":"2024年8月11日","autoDesc":true,"excerpt":"<p>Sentry是一个开源的应用性能监控（Application Performance Monitoring，APM）和错误追踪平台。 它帮助开发人员监控应用程序的性能、捕获和分析错误，以便及时发现并解决潜在的问题，提高应用程序的稳定性和用户体验</p>\\n<h2>部署 sentry （k8s）</h2>\\n<p>1.使用 helm 安装 <a href=\\"https://github.com/sentry-kubernetes/charts\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://github.com/sentry-kubernetes/charts</a></p>"}');export{c as comp,g as data};
